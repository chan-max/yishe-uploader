<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YiShe Uploader 控制台</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
</head>
<body>
    <div id="app" class="app-root">
        <aside class="sidebar">
            <div class="brand">YiShe Uploader</div>
            <nav class="menu">
                <button :class="['menu-item', currentView==='dashboard' && 'active']" @click="currentView='dashboard'">仪表盘</button>
                <button :class="['menu-item', currentView==='pending' && 'active']" @click="currentView='pending'">待发布商品</button>
                <button :class="['menu-item', currentView==='login' && 'active']" @click="currentView='login'">平台登录状态</button>
            </nav>
            <div class="sidebar-footer">
                <label class="env">
                    环境
                    <select v-model="env">
                        <option value="prod">生产环境</option>
                        <option value="dev">开发环境</option>
                    </select>
                </label>
            </div>
        </aside>
        <main class="main">
            <header class="topbar">
                <div class="title">
                    <h1 v-if="currentView==='dashboard'">仪表盘</h1>
                    <h1 v-else-if="currentView==='pending'">待发布商品</h1>
                    <h1 v-else>平台登录状态</h1>
                    <p>{{ subtitle }}</p>
                </div>
                <div class="actions">
                    <button v-if="currentView==='pending'" class="btn" @click="refreshPending">刷新列表</button>
                    <button v-if="currentView==='login'" class="btn" @click="checkLogin(true)">检查登录状态</button>
                </div>
            </header>

            <section class="content">
                <div v-if="status.message" :class="['status-panel', status.type]">{{ status.message }}</div>

                <template v-if="currentView==='dashboard'">
                    <div class="cards">
                        <div class="card">
                            <div class="card-title">待发布数量</div>
                            <div class="card-value">{{ pendingCountDisplay }}</div>
                            <div class="card-desc">来自 {{ env==='prod' ? '生产' : '开发' }} 环境</div>
                        </div>
                        <div class="card">
                            <div class="card-title">已登录平台</div>
                            <div class="card-value">{{ loggedInPlatforms }}</div>
                            <div class="card-desc">点击左侧查看详情</div>
                        </div>
                    </div>
                </template>

                <template v-else-if="currentView==='pending'">
                    <div class="table">
                        <div class="thead">
                            <div class="tr">
                                <div class="th th-id">ID</div>
                                <div class="th th-name">名称</div>
                                <div class="th th-imgs">图片</div>
                                <div class="th th-desc">描述</div>
                                <div class="th th-keywords">关键字</div>
                                <div class="th th-status">状态</div>
                                <div class="th th-actions">操作</div>
                            </div>
                        </div>
                        <div class="tbody">
                            <div v-for="item in pendingList" :key="item.id" class="tr">
                                <div class="td td-id">{{ item.id }}</div>
                                <div class="td td-name" :title="item.name">{{ item.name || '未命名商品' }}</div>
                                <div class="td td-images">
                                    <template v-if="item.images && item.images.length">
                                        <img v-for="(img,idx) in item.images.slice(0,3)" :key="idx" :src="img" :alt="item.name || '商品图片'" loading="lazy" />
                                        <span v-if="item.images.length>3" class="more">+{{ item.images.length - 3 }}</span>
                                    </template>
                                    <template v-else>—</template>
                                </div>
                                <div class="td td-desc">{{ item.description || '—' }}</div>
                                <div class="td td-keywords">{{ item.keywords || '—' }}</div>
                                <div class="td td-status">{{ item.publishStatus || '-' }}</div>
                                <div class="td td-actions">
                                    <button class="publish-btn" @click="publishSingle(item.id, $event)">发布</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </template>

                <template v-else>
                    <div class="login-status">
                        <span v-for="(info, platform) in loginStatus" :key="platform" :class="['login-badge', info.isLoggedIn ? 'ok' : (info.status==='error' ? 'warn' : 'err')]">
                            {{ platform }}：{{ info.isLoggedIn ? '已登录' : (info.status==='error' ? '异常' : '未登录') }}
                        </span>
                    </div>
                </template>
            </section>
        </main>
    </div>

    <script src="script.js"></script>
</body>
</html>